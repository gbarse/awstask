AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: GorB SAM Template (minimal)

# ────────────── global defaults ────────────────────────────────
Globals:
  Function:
    Runtime: java17
    MemorySize: 512        # MB
    Timeout: 30            # seconds
    Tracing: Active

# ────────────── resources ──────────────────────────────────────
Resources:

  GorBUploadsNotificationFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: GorB-UploadsNotificationFunction
      Handler: com.lambda.lambda.UploadNotificationHandler::handleRequest

      # Path to the shaded JAR that 'mvn package' puts under lambda/target/
      # (sam build / sam package will upload this for you)
      CodeUri: lambda/target/lambda-0.0.1-SNAPSHOT.jar

      Environment:
        Variables:
          SNS_TOPIC_ARN: arn:aws:sns:us-east-2:151182332702:GorB-Topic
          ALB_HOST: !ImportValue GorB-App-ALB-DNS

      Policies:
        - SQSPollerPolicy:
            QueueName: GorB-NotificationUploadQueue
        - Statement:
            Effect: Allow
            Action: sns:Publish
            Resource: arn:aws:sns:us-east-2:151182332702:GorB-Topic

      Events:
        SQSTrigger:
          Type: SQS
          Properties:
            Queue: arn:aws:sqs:us-east-2:151182332702:GorB-NotificationUploadQueue
            BatchSize: 5
